{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 40, "column": 0}, "map": {"version":3,"sources":["file:///C:/Mine/FusionSpace/photoparkk-dev/photoparkk-next/src/lib/supabase.js"],"sourcesContent":["import { createClient } from '@supabase/supabase-js';\r\n\r\nconst supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL;\r\nconst supabaseKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY;\r\n\r\nif (!supabaseUrl || !supabaseKey) {\r\n    console.warn('Supabase URL or Key is missing. Check your .env.local file.');\r\n}\r\n\r\n// Create a single supabase client for interacting with your database\r\nexport const supabase = createClient(supabaseUrl || '', supabaseKey || '');\r\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM;AACN,MAAM;AAEN;;AAKO,MAAM,WAAW,IAAA,gMAAY,EAAC,eAAe,IAAI,eAAe"}},
    {"offset": {"line": 85, "column": 0}, "map": {"version":3,"sources":["file:///C:/Mine/FusionSpace/photoparkk-dev/photoparkk-next/src/app/api/auth/register/route.js"],"sourcesContent":["\r\nimport { supabase } from '@/lib/supabase';\r\nimport bcrypt from 'bcryptjs';\r\nimport jwt from 'jsonwebtoken';\r\nimport { NextResponse } from 'next/server';\r\n\r\nexport async function POST(req) {\r\n    try {\r\n        const { name, email, password, role } = await req.json();\r\n        if (!name || !email || !password) {\r\n            return NextResponse.json({ message: \"Please fill all fields\" }, { status: 400 });\r\n        }\r\n\r\n        // Check if user exists\r\n        const { data: existingUser } = await supabase\r\n            .from('users')\r\n            .select('*')\r\n            .eq('email', email)\r\n            .single();\r\n\r\n        if (existingUser) {\r\n            return NextResponse.json({ message: \"User already exists\" }, { status: 400 });\r\n        }\r\n\r\n        // Hash password\r\n        const salt = await bcrypt.genSalt(10);\r\n        const hashedPassword = await bcrypt.hash(password, salt);\r\n\r\n        const allowedRoles = [\"admin\", \"customer\"];\r\n        const assignedRole = allowedRoles.includes(role) ? role : \"customer\";\r\n\r\n        // Insert user\r\n        const { data: newUser, error } = await supabase\r\n            .from('users')\r\n            .insert([\r\n                { name, email, password_hash: hashedPassword, role: assignedRole }\r\n            ])\r\n            .select()\r\n            .single();\r\n\r\n        if (error) throw error;\r\n\r\n        // Generate Tokens\r\n        const accessToken = jwt.sign({ id: newUser.id }, process.env.JWT_SECRET, { expiresIn: '15m' });\r\n        const refreshToken = jwt.sign({ id: newUser.id }, process.env.JWT_SECRET, { expiresIn: '7d' });\r\n\r\n        return NextResponse.json({\r\n            user: {\r\n                _id: newUser.id, // Keep _id format for compatibility with frontend if needed, or update frontend to use id\r\n                id: newUser.id,\r\n                name: newUser.name,\r\n                email: newUser.email,\r\n                role: newUser.role,\r\n            },\r\n            accessToken,\r\n            refreshToken,\r\n        }, { status: 201 });\r\n\r\n    } catch (error) {\r\n        console.error(\"Register Error:\", error);\r\n        return NextResponse.json({ message: \"Server Error\", error: error.message }, { status: 500 });\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;AACA;AACA;AACA;AACA;;;;;AAEO,eAAe,KAAK,GAAG;IAC1B,IAAI;QACA,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,QAAQ,EAAE,IAAI,EAAE,GAAG,MAAM,IAAI,IAAI;QACtD,IAAI,CAAC,QAAQ,CAAC,SAAS,CAAC,UAAU;YAC9B,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,SAAS;YAAyB,GAAG;gBAAE,QAAQ;YAAI;QAClF;QAEA,uBAAuB;QACvB,MAAM,EAAE,MAAM,YAAY,EAAE,GAAG,MAAM,oIAAQ,CACxC,IAAI,CAAC,SACL,MAAM,CAAC,KACP,EAAE,CAAC,SAAS,OACZ,MAAM;QAEX,IAAI,cAAc;YACd,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,SAAS;YAAsB,GAAG;gBAAE,QAAQ;YAAI;QAC/E;QAEA,gBAAgB;QAChB,MAAM,OAAO,MAAM,8IAAM,CAAC,OAAO,CAAC;QAClC,MAAM,iBAAiB,MAAM,8IAAM,CAAC,IAAI,CAAC,UAAU;QAEnD,MAAM,eAAe;YAAC;YAAS;SAAW;QAC1C,MAAM,eAAe,aAAa,QAAQ,CAAC,QAAQ,OAAO;QAE1D,cAAc;QACd,MAAM,EAAE,MAAM,OAAO,EAAE,KAAK,EAAE,GAAG,MAAM,oIAAQ,CAC1C,IAAI,CAAC,SACL,MAAM,CAAC;YACJ;gBAAE;gBAAM;gBAAO,eAAe;gBAAgB,MAAM;YAAa;SACpE,EACA,MAAM,GACN,MAAM;QAEX,IAAI,OAAO,MAAM;QAEjB,kBAAkB;QAClB,MAAM,cAAc,kJAAG,CAAC,IAAI,CAAC;YAAE,IAAI,QAAQ,EAAE;QAAC,GAAG,QAAQ,GAAG,CAAC,UAAU,EAAE;YAAE,WAAW;QAAM;QAC5F,MAAM,eAAe,kJAAG,CAAC,IAAI,CAAC;YAAE,IAAI,QAAQ,EAAE;QAAC,GAAG,QAAQ,GAAG,CAAC,UAAU,EAAE;YAAE,WAAW;QAAK;QAE5F,OAAO,gJAAY,CAAC,IAAI,CAAC;YACrB,MAAM;gBACF,KAAK,QAAQ,EAAE;gBACf,IAAI,QAAQ,EAAE;gBACd,MAAM,QAAQ,IAAI;gBAClB,OAAO,QAAQ,KAAK;gBACpB,MAAM,QAAQ,IAAI;YACtB;YACA;YACA;QACJ,GAAG;YAAE,QAAQ;QAAI;IAErB,EAAE,OAAO,OAAO;QACZ,QAAQ,KAAK,CAAC,mBAAmB;QACjC,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,SAAS;YAAgB,OAAO,MAAM,OAAO;QAAC,GAAG;YAAE,QAAQ;QAAI;IAC9F;AACJ"}}]
}