{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 40, "column": 0}, "map": {"version":3,"sources":["file:///C:/Mine/FusionSpace/photoparkk-dev/photoparkk-next/src/lib/supabase.js"],"sourcesContent":["import { createClient } from '@supabase/supabase-js';\r\n\r\nconst supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL;\r\nconst supabaseKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY;\r\n\r\nif (!supabaseUrl || !supabaseKey) {\r\n    console.warn('Supabase URL or Key is missing. Check your .env.local file.');\r\n}\r\n\r\n// Create a single supabase client for interacting with your database\r\nexport const supabase = createClient(supabaseUrl || '', supabaseKey || '');\r\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM;AACN,MAAM;AAEN;;AAKO,MAAM,WAAW,IAAA,gMAAY,EAAC,eAAe,IAAI,eAAe"}},
    {"offset": {"line": 61, "column": 0}, "map": {"version":3,"sources":["file:///C:/Mine/FusionSpace/photoparkk-dev/photoparkk-next/src/app/api/orders/route.js"],"sourcesContent":["\r\nimport { supabase } from '@/lib/supabase';\r\nimport { NextResponse } from 'next/server';\r\n\r\nexport async function GET(request) {\r\n    try {\r\n        const { searchParams } = new URL(request.url);\r\n        const page = parseInt(searchParams.get('page') || '1');\r\n        const limit = parseInt(searchParams.get('limit') || '10');\r\n        const status = searchParams.get('status');\r\n        const search = searchParams.get('search');\r\n\r\n        const from = (page - 1) * limit;\r\n        const to = from + limit - 1;\r\n\r\n        let query = supabase\r\n            .from('orders')\r\n            .select('*', { count: 'exact' })\r\n            .order('created_at', { ascending: false })\r\n            .range(from, to);\r\n\r\n        if (status && status !== 'all') {\r\n            const mappedStatus = status.charAt(0).toUpperCase() + status.slice(1);\r\n            query = query.eq('status', mappedStatus);\r\n        }\r\n\r\n        // Search? orders table filtering on JSONB is hard for 'delivery_details->>name'\r\n        // But we can filter on ID or other fields.\r\n        // Implementing basic ID search or simple status filtering.\r\n        // Full text search on JSONB is complex in this setup without extensions.\r\n        // We'll skip complex search for now or just filter in memory if dataset small (not scalable).\r\n        // Let's implement basics.\r\n\r\n        const { data, count, error } = await query;\r\n\r\n        if (error) throw error;\r\n\r\n        return NextResponse.json({\r\n            orders: data,\r\n            total: count,\r\n            page,\r\n            totalPages: Math.ceil((count || 0) / limit)\r\n        });\r\n\r\n    } catch (error) {\r\n        console.error(\"Fetch Orders Error:\", error);\r\n        return NextResponse.json({ message: \"Error fetching orders\" }, { status: 500 });\r\n    }\r\n}\r\n\r\nexport async function POST(request) {\r\n    try {\r\n        const formData = await request.formData();\r\n        const cartItemId = formData.get('cartItemId');\r\n        const productType = formData.get('productType');\r\n        const amount = formData.get('amount');\r\n        const deliveryDetailsRaw = formData.get('deliveryDetails');\r\n\r\n        // Parse delivery details or default to empty object\r\n        let deliveryDetails = deliveryDetailsRaw ? JSON.parse(deliveryDetailsRaw) : {};\r\n\r\n        // Fetch Cart Item\r\n        const { data: cartItem, error: cartError } = await supabase\r\n            .from('cart_items')\r\n            .select('*')\r\n            .eq('id', cartItemId)\r\n            .single();\r\n\r\n        if (cartError || !cartItem) {\r\n            return NextResponse.json({ message: \"Cart item not found\" }, { status: 404 });\r\n        }\r\n\r\n        // Add item snapshot to deliveryDetails (as a hack/workaround to store it in existing jsonb column)\r\n        // We will store it under 'itemSnapshot' key.\r\n        deliveryDetails.itemSnapshot = {\r\n            title: cartItem.title,\r\n            quantity: cartItem.quantity,\r\n            size: cartItem.size,\r\n            thickness: cartItem.thickness,\r\n            image: cartItem.image || cartItem.uploaded_image_url,\r\n            price: cartItem.price,\r\n            product_id: cartItem.product_id,\r\n            product_type: cartItem.product_type\r\n        };\r\n\r\n        const { data: order, error: orderError } = await supabase\r\n            .from('orders')\r\n            .insert([\r\n                {\r\n                    user_id: cartItem.user_id,\r\n                    cart_item_id: cartItemId, // We keep the ID reference even if deleted, for traceability if logged separately\r\n                    product_type: productType,\r\n                    delivery_details: deliveryDetails,\r\n                    image: cartItem.image || cartItem.uploaded_image_url,\r\n                    amount: amount,\r\n                    status: 'Pending',\r\n                    payment_status: 'pending' // Default\r\n                }\r\n            ])\r\n            .select()\r\n            .single();\r\n\r\n        if (orderError) {\r\n            console.error(\"Supabase Order Insert Error:\", orderError);\r\n            return NextResponse.json({ message: \"Failed to place order\" }, { status: 500 });\r\n        }\r\n\r\n        // Delete from cart\r\n        await supabase.from('cart_items').delete().eq('id', cartItemId);\r\n\r\n        return NextResponse.json({ message: \"Order placed successfully\", order });\r\n\r\n    } catch (error) {\r\n        console.error(\"Order API Error:\", error);\r\n        return NextResponse.json({ message: \"Server Error\" }, { status: 500 });\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;;;AACA;AACA;;;AAEO,eAAe,IAAI,OAAO;IAC7B,IAAI;QACA,MAAM,EAAE,YAAY,EAAE,GAAG,IAAI,IAAI,QAAQ,GAAG;QAC5C,MAAM,OAAO,SAAS,aAAa,GAAG,CAAC,WAAW;QAClD,MAAM,QAAQ,SAAS,aAAa,GAAG,CAAC,YAAY;QACpD,MAAM,SAAS,aAAa,GAAG,CAAC;QAChC,MAAM,SAAS,aAAa,GAAG,CAAC;QAEhC,MAAM,OAAO,CAAC,OAAO,CAAC,IAAI;QAC1B,MAAM,KAAK,OAAO,QAAQ;QAE1B,IAAI,QAAQ,oIAAQ,CACf,IAAI,CAAC,UACL,MAAM,CAAC,KAAK;YAAE,OAAO;QAAQ,GAC7B,KAAK,CAAC,cAAc;YAAE,WAAW;QAAM,GACvC,KAAK,CAAC,MAAM;QAEjB,IAAI,UAAU,WAAW,OAAO;YAC5B,MAAM,eAAe,OAAO,MAAM,CAAC,GAAG,WAAW,KAAK,OAAO,KAAK,CAAC;YACnE,QAAQ,MAAM,EAAE,CAAC,UAAU;QAC/B;QAEA,gFAAgF;QAChF,2CAA2C;QAC3C,2DAA2D;QAC3D,yEAAyE;QACzE,8FAA8F;QAC9F,0BAA0B;QAE1B,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,KAAK,EAAE,GAAG,MAAM;QAErC,IAAI,OAAO,MAAM;QAEjB,OAAO,gJAAY,CAAC,IAAI,CAAC;YACrB,QAAQ;YACR,OAAO;YACP;YACA,YAAY,KAAK,IAAI,CAAC,CAAC,SAAS,CAAC,IAAI;QACzC;IAEJ,EAAE,OAAO,OAAO;QACZ,QAAQ,KAAK,CAAC,uBAAuB;QACrC,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,SAAS;QAAwB,GAAG;YAAE,QAAQ;QAAI;IACjF;AACJ;AAEO,eAAe,KAAK,OAAO;IAC9B,IAAI;QACA,MAAM,WAAW,MAAM,QAAQ,QAAQ;QACvC,MAAM,aAAa,SAAS,GAAG,CAAC;QAChC,MAAM,cAAc,SAAS,GAAG,CAAC;QACjC,MAAM,SAAS,SAAS,GAAG,CAAC;QAC5B,MAAM,qBAAqB,SAAS,GAAG,CAAC;QAExC,oDAAoD;QACpD,IAAI,kBAAkB,qBAAqB,KAAK,KAAK,CAAC,sBAAsB,CAAC;QAE7E,kBAAkB;QAClB,MAAM,EAAE,MAAM,QAAQ,EAAE,OAAO,SAAS,EAAE,GAAG,MAAM,oIAAQ,CACtD,IAAI,CAAC,cACL,MAAM,CAAC,KACP,EAAE,CAAC,MAAM,YACT,MAAM;QAEX,IAAI,aAAa,CAAC,UAAU;YACxB,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,SAAS;YAAsB,GAAG;gBAAE,QAAQ;YAAI;QAC/E;QAEA,mGAAmG;QACnG,6CAA6C;QAC7C,gBAAgB,YAAY,GAAG;YAC3B,OAAO,SAAS,KAAK;YACrB,UAAU,SAAS,QAAQ;YAC3B,MAAM,SAAS,IAAI;YACnB,WAAW,SAAS,SAAS;YAC7B,OAAO,SAAS,KAAK,IAAI,SAAS,kBAAkB;YACpD,OAAO,SAAS,KAAK;YACrB,YAAY,SAAS,UAAU;YAC/B,cAAc,SAAS,YAAY;QACvC;QAEA,MAAM,EAAE,MAAM,KAAK,EAAE,OAAO,UAAU,EAAE,GAAG,MAAM,oIAAQ,CACpD,IAAI,CAAC,UACL,MAAM,CAAC;YACJ;gBACI,SAAS,SAAS,OAAO;gBACzB,cAAc;gBACd,cAAc;gBACd,kBAAkB;gBAClB,OAAO,SAAS,KAAK,IAAI,SAAS,kBAAkB;gBACpD,QAAQ;gBACR,QAAQ;gBACR,gBAAgB,UAAU,UAAU;YACxC;SACH,EACA,MAAM,GACN,MAAM;QAEX,IAAI,YAAY;YACZ,QAAQ,KAAK,CAAC,gCAAgC;YAC9C,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,SAAS;YAAwB,GAAG;gBAAE,QAAQ;YAAI;QACjF;QAEA,mBAAmB;QACnB,MAAM,oIAAQ,CAAC,IAAI,CAAC,cAAc,MAAM,GAAG,EAAE,CAAC,MAAM;QAEpD,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,SAAS;YAA6B;QAAM;IAE3E,EAAE,OAAO,OAAO;QACZ,QAAQ,KAAK,CAAC,oBAAoB;QAClC,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,SAAS;QAAe,GAAG;YAAE,QAAQ;QAAI;IACxE;AACJ"}}]
}